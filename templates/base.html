<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Arabic AI Prompts{% endblock %}</title>
    {# You can link your CSS here later #}
     {# Add CSRF token for HTMX #}
    <meta name="csrf-token" content="{{ csrf_token }}">
</head>
<body>
    <header>
        <h1>Arabic AI Prompts</h1>
        <nav>
            <a href="{% url 'home' %}">Home</a>
            {% if user.is_authenticated %}
                | <a href="{% url 'submit_prompt' %}">Submit Prompt</a>
                | <a href="{% url 'logout' %}">Logout</a>
                | <a href="/admin/">Admin</a>
            {% else %}
                | <a href="{% url 'login' %}">Login</a>
                {# Link to registration later #}
            {% endif %}
        </nav>
    </header>

    <main>
        {% block content %}
        {# Content from child templates will go here #}
        {% endblock %}
    </main>

    <footer>
        <p>&copy; 2023 Arabic AI Prompts</p>
    </footer>

        {# Include HTMX script #}
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    {# Optional: Include htmx.org/ext/csrf.js for easier CSRF handling with HTMX #}
    <script src="https://unpkg.com/htmx.org/dist/ext/csrf.js"></script>

    <script>
        // Get the WebSocket protocol (ws or wss) based on the current page's protocol
        const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        // Construct the WebSocket URL
        const wsUrl = wsProtocol + '//' + window.location.host + '/ws/prompts/';

        // Create a new WebSocket connection
        const promptSocket = new WebSocket(wsUrl);

        // Event handler for when the connection is opened
        promptSocket.onopen = function(e) {
            console.log('WebSocket connection opened:', e);
            // You could send an initial message to the server here if needed
            // promptSocket.send(JSON.stringify({ 'message': 'Hello from client!' }));
        };

        // Event handler for receiving messages from the server
        promptSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            console.log('WebSocket message received:', data);
            // This is where you would handle incoming real-time data,
            // e.g., display a notification for a new prompt.
            // For now, we'll just log it.
            alert('New real-time message: ' + data.message); // Simple alert for demonstration
        };

        // Event handler for when the connection is closed
        promptSocket.onclose = function(e) {
            console.error('WebSocket connection closed unexpectedly:', e);
            // You might want to try reconnecting here
        };

        // Event handler for WebSocket errors
        promptSocket.onerror = function(e) {
            console.error('WebSocket error:', e);
        };

        // Example function to send a message (not used in this basic setup yet)
        // function sendWebSocketMessage(message) {
        //     promptSocket.send(JSON.stringify({ 'message': message }));
        // }

    </script>
</body>
</html>
